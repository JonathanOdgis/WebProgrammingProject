<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Records</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  </head>
  <body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript" src= https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.0-beta.2/angular.min.js></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.4/handlebars.min.js"></script>
      
    <div class = "container">
        <div id = "header">
            <nav class="navbar navbar-fixed navbar-default" id = "navbar">
              <div class="container-fluid">
                <div id = "navbaritems">
                  <ul class = "nav navbar-nav">
                    <div class="navbar-header">
                        <a class="navbar-brand" href="index.html"> Fit List </a>
                    </div>          
                    <li><a href="#" id = "person-button">Person </a></li>
                    <li><a href="#" id = "food-button">Food </a></li>
                    <li><a href="#" id = "drink-button"> Drink </a></li>
                    <li><a href="#" id = "exercise-button"> Exercise </a></li>
                    <li><a href="#" id = "weight-button"> Weight </a></li>
                    <li><a href="#" id = "sleep-button"> Sleep </a></li>
                    <li><a href="#" id = "blood-pressure-button"> Blood Pressure </a></li>
                    <li><a href="#"> Medicine </a></li>
                    
                    

                    <li><a href = "#"><img src = "http://www.iid.com/Home/ShowImage?id=299&t=635648001335730000" style = "width: 30px"></a></li>            
                    <li><a href = "#"><img src = "https://www.hrc.co.nz/index.php/download_file/view_inline/893/" style = "width: 30px"></a></li>
                    <li><a href = "#"><img src = "http://a4.mzstatic.com/us/r30/Purple69/v4/14/79/45/147945c1-8234-f71b-2018-9c22475473f2/icon320x320.jpeg" style = "width: 30px"></a></li>                  
                </div>
              </div>
            </nav>
        </div>      
            <div id="view" ></div>
    </div>

    <div class="modal fade" id="myDialog">
      <div class="modal-dialog">
        <div class="modal-content">
        <form class="form-horizontal" >
          <div class="modal-header">
            <a href="?" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></a>
            <h4 class="modal-title" ></h4>
          </div>
        	<div class="modal-body">
        	</div>
        	<div class="modal-footer">
        		<a href="?" class="btn btn-default" data-dismiss="modal" >Cancel </a>
        		<input type="submit" name="submit" class="btn btn-primary submit" value="Save changes" />
        	</div>
        </form>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    
    <script type="text/javascript">

        
        
        $(function(){
            var personEditTemplate = Handlebars.compile($("#person-edit-tmpl").html());
            var personIndexTemplate = Handlebars.compile($("#person-index-tmpl").html());
            
            var foodEditTemplate = Handlebars.compile($("#food-edit-tmpl").html());
            var foodIndexTemplate = Handlebars.compile($("#food-index-tmpl").html());
            
            var drinkEditTemplate = Handlebars.compile($("#drink-edit-tmpl").html());
            var drinkIndexTemplate = Handlebars.compile($("#drink-index-tmpl").html());
            
            var exerciseEditTemplate = Handlebars.compile($("#exercise-edit-tmpl").html());
            var exerciseIndexTemplate = Handlebars.compile($("#exercise-index-tmpl").html());
            
            //var sleepDeleteTemplate = Handlebars.compile($("#sleep-delete-tmpl").html());
            //var sleepEditTemplate = Handlebars.compile($("#sleep-edit-tmpl").html());
            //var sleepIndexTemplate = Handlebars.compile($("#sleep-index-tmpl").html());
            
            //var bloodPressureDeleteTemplate = Handlebars.compile($("#bloodPressure-delete-tmpl").html());
            //var bloodPressureEditTemplate = Handlebars.compile($("#bloodPressure-edit-tmpl").html());
            //var bloodPressureIndexTemplate = Handlebars.compile($("#bloodPressure-index-tmpl").html());
            
            //var weightDeleteTemplate = Handlebars.compile($("#weight-delete-tmpl").html());
            //var weightEditTemplate = Handlebars.compile($("#weight-edit-tmpl").html());
            //var weightIndexTemplate = Handlebars.compile($("#weight-index-tmpl").html());
            
            //Start here method
            $.getJSON("person").then(function(data){
                var html = personIndexTemplate({rows: data});
                $("#view").html(html);
            });
            
            //Event if the person button is clicked
            $("#person-button").on("click", function(){  
                $.getJSON("person").then(function(data){
                var html = personIndexTemplate({rows: data});  //The way to change the page based on the click on the nav bar item id = food button
                $("#view").html(html);
            });                
            })
            //Event if the food button is clicked
            $("#food-button").on("click", function(){  
                $.getJSON("food").then(function(data){
                var html = foodIndexTemplate({rows: data});  //The way to change the page based on the click on the nav bar item id = food button
                $("#view").html(html);
            });                
            })
            //Event if the drink button is clicked
            $("#drink-button").on("click", function(){  
                $.getJSON("drink").then(function(data){
                var html = drinkIndexTemplate({rows: data});  //The way to change the page based on the click on the nav bar item id = food button
                $("#view").html(html);
            });                
            })
            //Event if the Exercise button is clicked
            $("#exercise-button").on("click", function(){  
                $.getJSON("exercise").then(function(data){
                var html = exerciseIndexTemplate({rows: data});  //The way to change the page based on the click on the nav bar item id = food button
                $("#view").html(html);
            });                
            })
    
            //Event if the Sleep button is clicked
            /*
            $("#sleep-button").on("click", function(){  
                $.getJSON("exercise").then(function(data){
                var html = exerciseIndexTemplate({rows: data});  //The way to change the page based on the click on the nav bar item id = food button
                $("#view").html(html);
            });                
            })
            */
            
            //Event if the Blood Pressure button is clicked
            /*
            $("#blood-pressure-button").on("click", function(){  
                $.getJSON("exercise").then(function(data){
                var html = exerciseIndexTemplate({rows: data});  //The way to change the page based on the click on the nav bar item id = food button
                $("#view").html(html);
            });                
            })
            */
            
            //Event if the Weight button is clicked
            /*
            $("#weight-button").on("click", function(){  
                $.getJSON("exercise").then(function(data){
                var html = exerciseIndexTemplate({rows: data});  //The way to change the page based on the click on the nav bar item id = food button
                $("#view").html(html);
            });                
            })
            */            
    
            //Edit
            /*
            $("#view").on("click", ".edit", function(){
                var $self = $(this);
                $.getJSON(this.href).then(function(data){
                    var html = personEditTemplate(data);
                    var $tr = $self.closest("tr").after(html).hide()
                });
                return false;
            });
            */ 
             
            //View/Delete Ajax
            /*
            $("#view").on("click", ".ajax", function(){
                $.get(this.href + "&format=plain").then(function(data){
                    $("#myDialog .modal-content").html(data);
                    $("#myDialog").modal('show');
                });
                return false;
            });
            */
            
            //Add Records
            
            //person add records (The working one)
            $("#view").on("click", ".add-person", function(){
                $("#myDialog .modal-title").html("Add a person");
                $("#myDialog .modal-body").html(personEditTemplate({}));
                $("#myDialog").modal('show');
                $("#myDialog .modal-body .btn-primary").hide();
                $("#myDialog .submit").one('click', function(){
                    $.ajax({ url: 'person/', type: 'POST', data: $("#myDialog input").serialize() })
                    .done(function(data){
                        location.reload();
                    }).fail(function(data){
                        alert(data.responseJSON.code);
                    });
                    return false;
                });
                return false;
            });

            //food add records
            $("#view").on("click", ".add-food", function(){
                $("#myDialog .modal-title").html("Add a food");     //Ask for a person via a box and get the value of that person
                var persons_id = $("#persons_id").val();      //person reference
                $("#myDialog .modal-body").html(foodEditTemplate({persons_id: persons_id }));  //creating a json object
                $("#myDialog").modal('show');
                $("#myDialog .modal-body .btn-primary").hide();
                $("#myDialog .submit").one('click', function(){
                    $.ajax({ url: 'food/', type: 'POST', data: $("#myDialog input").serialize() })  //TODO: check the express and the food.js for the person_id being included. The data is being passed. it just needs to be processed right. 
                    .done(function(data){
                        location.reload();
                    }).fail(function(data){
                        alert(data.responseJSON.code);
                    });
                    return false;
                });
                return false;
            });

            //drink add records
            $("#view").on("click", ".add-drink", function(){
                $("#myDialog .modal-title").html("Add a drink");
                $("#myDialog .modal-body").html(drinkEditTemplate({}));
                $("#myDialog").modal('show');
                $("#myDialog .modal-body .btn-primary").hide();
                $("#myDialog .submit").one('click', function(){
                    $.ajax({ url: '/drink/', type: 'POST', data: $("#myDialog input").serialize() })
                    .done(function(data){
                        location.reload();
                    }).fail(function(data){
                        alert(data.responseJSON.code);
                    });
                    return false;
                });
                return false;
            });

            //exercise add records
            $("#view").on("click", ".add-exercise", function(){
                $("#myDialog .modal-title").html("Add an exercise");
                $("#myDialog .modal-body").html(exerciseEditTemplate({}));
                $("#myDialog").modal('show');
                $("#myDialog .modal-body .btn-primary").hide();
                $("#myDialog .submit").one('click', function(){
                    $.ajax({ url: '/exercise/', type: 'POST', data: $("#myDialog input").serialize() })
                    .done(function(data){
                        location.reload();
                    }).fail(function(data){
                        alert(data.responseJSON.code);
                    });
                    return false;
                });
                return false;
            });
            
            //edits
            
            
            //persons edit
            $("#view").on("click", ".person .edit", function(){
                var $self = $(this);
                $.getJSON(this.href).then(function(data){
                    var html = personEditTemplate(data);
                    var $tr = $self.closest("tr").after(html).hide()
                    $tr.next().find(".submit").one('click', function(){
                        $.ajax({ url: 'person/', type: 'POST', data: $tr.next().find("input").serialize() })
                        .done(function(data){
                            location.reload();
                        }).fail(function(data){
                            alert(data.responseJSON.code);
                        });
                        return false;
                    });
                });
                return false;
            });

            //foods edit
            $("#view").on("click", ".food .edit", function(){
                var $self = $(this);
                $.getJSON(this.href).then(function(data){
                    var html = foodEditTemplate(data);
                    var $tr = $self.closest("tr").after(html).hide()
                    $tr.next().find(".submit").one('click', function(){
                        $.ajax({ url: '/food/', type: 'POST', data: $tr.next().find("input").serialize() })
                        .done(function(data){
                            location.reload();
                        }).fail(function(data){
                            alert(data.responseJSON.code);
                        });
                        return false;
                    });
                });
                return false;
            });

            //drink edit
            $("#view").on("click", ".drink .edit", function(){
                var $self = $(this);
                $.getJSON(this.href).then(function(data){
                    var html = drinkEditTemplate(data);
                    var $tr = $self.closest("tr").after(html).hide()
                    $tr.next().find(".submit").one('click', function(){
                        $.ajax({ url: '/drink/', type: 'POST', data: $tr.next().find("input").serialize() })
                        .done(function(data){
                            location.reload();
                        }).fail(function(data){
                            alert(data.responseJSON.code);
                        });
                        return false;
                    });
                });
                return false;
            });
            
            //exercise edit
            $("#view").on("click", ".exercise .edit", function(){
                var $self = $(this);
                $.getJSON(this.href).then(function(data){
                    var html = exerciseEditTemplate(data);
                    var $tr = $self.closest("tr").after(html).hide()
                    $tr.next().find(".submit").one('click', function(){
                        $.ajax({ url: '/exercise/', type: 'POST', data: $tr.next().find("input").serialize() })
                        .done(function(data){
                            location.reload();
                        }).fail(function(data){
                            alert(data.responseJSON.code);
                        });
                        return false;
                    });
                });
                return false;
            });            
            
            //deletes
            
            //person delete
            $("#view").on("click", ".person .delete", function(){   //persons based script and also this is the best one to look at to understand the others
                $self = $(this); 
                $.get(this.href).then(function(data){
                    $("#myDialog .modal-title").html("Delete a person");
                    $("#myDialog .modal-body").html("<h5>Are you sure you want to delete " + data.firstname + "?</h5>");
                    $("#myDialog .submit").one('click', function(){
                        $.ajax({ url: '/person/' + data.persons_id, type: 'DELETE'})
                        .done(function(data){
                            $self.closest('tr').remove();
                            $("#myDialog").modal('hide');
                        }).fail(function(data){
                            alert(data.responseJSON.code);
                        });
                        return false; 
                    });
                    $("#myDialog").modal('show');
                });
                return false;
            });            

            //food delete
            $("#view").on("click", ".food .delete", function(){   //persons based script and also this is the best one to look at to understand the others
                $self = $(this); 
                $.get(this.href).then(function(data){
                    $("#myDialog .modal-title").html("Delete a food?");
                    $("#myDialog .modal-body").html("<h5>Are you sure you want to delete " + data.foodname + "?</h5>");
                    $("#myDialog .submit").one('click', function(){
                        $.ajax({ url: '/food/' + data.foods_id, type: 'DELETE'})
                        .done(function(data){
                            $self.closest('tr').remove();
                            $("#myDialog").modal('hide');
                        }).fail(function(data){
                            alert(data.responseJSON.code);
                        });
                        return false;
                    });
                    $("#myDialog").modal('show');
                });
                return false;
            });            

            //drink delete
            $("#view").on("click", ".drink .delete", function(){   //persons based script and also this is the best one to look at to understand the others
                $self = $(this); 
                $.get(this.href).then(function(data){
                    $("#myDialog .modal-title").html("Delete a drink?");
                    $("#myDialog .modal-body").html("<h5>Are you sure you want to delete " + data.drinkname + "?</h5>");
                    $("#myDialog .submit").one('click', function(){
                        $.ajax({ url: '/drink/' + data.drinks_id, type: 'DELETE'})
                        .done(function(data){
                            $self.closest('tr').remove();
                            $("#myDialog").modal('hide');
                        }).fail(function(data){
                            alert(data.responseJSON.code);
                        });
                        return false;
                    });
                    $("#myDialog").modal('show');
                });
                return false;
            });      


            
            //exercise delete
            $("#view").on("click", ".exercise .delete", function(){   //persons based script and also this is the best one to look at to understand the others
                $self = $(this); 
                $.get(this.href).then(function(data){
                    $("#myDialog .modal-title").html("Delete an exercise?");
                    $("#myDialog .modal-body").html("<h5>Are you sure you want to delete " + data.name + "?</h5>");
                    $("#myDialog .submit").one('click', function(){
                        $.ajax({ url: 'exercise/' + data.exercise_id, type: 'DELETE'})
                        .done(function(data){
                            $self.closest('tr').remove();
                            $("#myDialog").modal('hide');
                        }).fail(function(data){
                            alert(data.responseJSON.code);
                        });
                        return false;
                    });
                    $("#myDialog").modal('show');
                });
                return false;
            });                  
            
        });
    </script>
    
    <!--PERSONS Template-->
    <script type="text/template" id="person-index-tmpl">
        <a href="#" class="btn btn-success ajax add-person">
            <i class="glyphicon glyphicon-plus"></i>
            New Record
        </a>
        <br />

        <table class="table table-striped person"> 
            <thead>
                <tr>
                    <th>Actions</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Persons id</th>
                </tr>
            </thead>
            <tbody>
                {{#each rows}}
                    <tr>
                          <th scope="row">
                            <div class="btn-group" role="group" aria-label="...">
                              <a href="" title="View" class="btn btn-default btn-xs ajax"><i class="glyphicon glyphicon-eye-open"></i></a>
                              <a href="/person/{{persons_id}}" title="Edit" class="btn btn-default btn-xs edit"><i class="glyphicon glyphicon-edit"></i></a>
                              <a href="/person/{{persons_id}}" title="Delete" class="btn btn-default btn-xs delete"><i class="glyphicon glyphicon-trash"></i></a>
                            </div>
                          </th>
                        <td>{{firstname}}</td>
                        <td>{{lastname}}</td>
                        <td>{{persons_id}}</td>
                    </tr>
                {{/each}}
            </tbody>
        </table>
    </script>
    
    <script type="text/template" id="person-edit-tmpl" >
    <tr>

       <td><input type="text" id = "firstName" name="firstName" class="form-control" placeholder="firstname" value="{{firstname}}" /></td>
       <td><input type="text" id = "lastName" name="lastName" class="form-control" placeholder="lastname" value="{{lastname}}" /></td>
       <td><input type="text" name="persons_id" class="form-control" placeholder="persons_id" value="{{persons_id}}" /></td>
       <td>
         <input type="submit" value="Submit" class="btn btn-primary submit"/>
       </td>
    </tr>
    </script>
    
    <!--FOODS Template-->
    <script type="text/template" id="food-index-tmpl">
        <a href="#" class="btn btn-success ajax add-food">
            <i class="glyphicon glyphicon-plus"></i>
            New Record
        </a>
        <br />

        <table class="table table-striped food">
            <thead>
                <tr>
                    <th>Actions</th>
                    <th>Food Name</th>
                    <th>Calories</th>
                    <th>Foods_id</th>
                    <th>Persons_id</th>
                </tr>
            </thead>
            <tbody>
                {{#each rows}}
                    <tr>
                          <th scope="row">
                            <div class="btn-group" role="group" aria-label="...">
                              <a href="" title="View" class="btn btn-default btn-xs ajax"><i class="glyphicon glyphicon-eye-open"></i></a>
                              <a href="./food/{{foods_id}}" title="Edit" class="btn btn-default btn-xs edit"><i class="glyphicon glyphicon-edit"></i></a>
                              <a href="./food/{{foods_id}}" title="Delete" class="btn btn-default btn-xs delete"><i class="glyphicon glyphicon-trash"></i></a>
                            </div>
                          </th>
                        <td>{{foodname}}</td>
                        <td>{{calories}}</td>
                        <td>{{foods_id}}</td>
                        <td>{{persons_id}}</td>
                    </tr>
                {{/each}}
            </tbody>
        </table>
    </script>    

    <script type="text/template" id="food-edit-tmpl" >
    <tr>
       <td><input type="text" id = "foodName" name="foodName" class="form-control" placeholder="food" value="{{foodname}}" /></td>
       <td><input type="text" id = "calories" name="calories" class="form-control" placeholder="calories" value="{{calories}}" /></td>
       <td><input type="text" id = "foods_id" name="foods_id" class="form-control" placeholder = "foods_id" value="{{foods_id}}" /> </td>     
       <td><input type="text" id = "persons_id" name="persons_id" class="form-control" placeholder="persons_id" value="{{persons_id}}" /></td>
       <td>
         <input type="submit" value="Submit" class="btn btn-primary"/>
       </td>
    </tr>
    </script>



    <!--DRINKS Template-->
    <script type="text/template" id="drink-index-tmpl">
        <a href="#" class="btn btn-success add-drink">
            <i class="glyphicon glyphicon-plus"></i>
            New Record
        </a>
        <br />

        <table class="table table-striped drink">
            <thead>
                <tr>
                    <th>Actions</th>
                    <th>Drink Name</th>
                    <th>Calories</th>
                </tr>
            </thead>
            <tbody>
                {{#each rows}}
                    <tr>
                          <th scope="row">
                            <div class="btn-group" role="group" aria-label="...">
                              <a href="" title="View" class="btn btn-default btn-xs ajax"><i class="glyphicon glyphicon-eye-open"></i></a>
                              <a href="/drink/{{drinks_id}}" title="Edit" class="btn btn-default btn-xs edit"><i class="glyphicon glyphicon-edit"></i></a>
                              <a href="/drink/{{drinks_id}}" title="Delete" class="btn btn-default btn-xs delete"><i class="glyphicon glyphicon-trash"></i></a>
                            </div>
                          </th>
                        <td>{{drinkname}}</td>
                        <td>{{drinkcalories}}</td>
                    </tr>
                {{/each}}
            </tbody>
        </table>
    </script>    

    <script type="text/template" id="drink-edit-tmpl" >
    <tr>
       <td><input type="text" name="Drink Name" class="form-control" placeholder="drink" value="{{drinkname}}" /></td>
       <td><input type="text" name="Calories" class="form-control" placeholder="calories" value="{{drinkcalories}}" /></td>
       <td><input type="text" id = "persons_id" name="persons_id" class="form-control" placeholder="persons_id" value="{{persons_id}}" /></td>
       <td>
         <input type="submit" value="Submit" class="btn btn-primary"/>
       </td>
    </tr>
    </script>


    <!--EXERCISE Template-->
    <script type="text/template" id="exercise-index-tmpl">
        <a href="#" class="btn btn-success ajax add-exercise">
            <i class="glyphicon glyphicon-plus"></i>
            New Record
        </a>
        <br />

        <table class="table table-striped exercise">
            <thead>
                <tr>
                    <th>Actions</th>
                    <th>Food Name</th>
                    <th>Calories</th>
                </tr>
            </thead>
            <tbody>
                {{#each rows}}
                    <tr>
                          <th scope="row">
                            <div class="btn-group" role="group" aria-label="...">
                              <a href="" title="View" class="btn btn-default btn-xs ajax"><i class="glyphicon glyphicon-eye-open"></i></a>
                              <a href="./exercise/{{exercise_id}}" title="Edit" class="btn btn-default btn-xs edit"><i class="glyphicon glyphicon-edit"></i></a>
                              <a href="./exercise/{{exercise_id}}" title="Delete" class="btn btn-default btn-xs delete"><i class="glyphicon glyphicon-trash"></i></a>
                            </div>
                          </th>
                        <td>{{name}}</td>
                        <td>{{calories_burned}}</td>
                    </tr>
                {{/each}}
            </tbody>
        </table>
    </script>    

    <script type="text/template" id="exercise-edit-tmpl" >
    <tr>
       <td><input type="text" name="Food Name" class="form-control" placeholder="exercise name" value="{{name}}" /></td>
       <td><input type="text" name="Calories" class="form-control" placeholder="calories burned" value="{{calories_burned}}" /></td>
       <td>
         <input type="submit" value="Submit" class="btn btn-primary"/>
         <input type="hidden" name="id" value="{{name}}" /> 
       </td>
    </tr>
    </script>
    
  </body>
</html>